openapi: 3.1.0
info:
  title: agent-executor OpenAPI
  description: This is a agent-executor OpenAPI schema
  version: 1.0.0

servers:
  - url: 'https://{host}:{port}'
    description: 'host: DIP服务器IP, port: 默认端口443'
    variables:
      host:
        default: host
        description: DIP服务器IP
      port:
        default: '443'
        description: https默认端口443

tags:
  - name: Agent运行
  - name: 对话Session


paths:
  /api/agent-executor/v1/agent/run:
    post:
      tags:
      - Agent运行
      summary: 运行agent
      description: 运行agent
      operationId: run_agent_api_agent_executor_v1_agent_run_post
      parameters:
        - $ref: './schema/common_auth_header.yaml#/CommonAuthHeaderParams/parameters/x-user'
        - $ref: './schema/common_auth_header.yaml#/CommonAuthHeaderParams/parameters/x-visitor-type'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunAgentParam'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunAgentResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/agent-executor/v1/agent/debug:
    post:
      tags:
      - Agent运行
      summary: 调试agent
      description: 调试agent
      operationId: debug_agent_api_agent_executor_v1_agent_debug_post
      parameters:
        - $ref: './schema/common_auth_header.yaml#/CommonAuthHeaderParams/parameters/x-user'
        - $ref: './schema/common_auth_header.yaml#/CommonAuthHeaderParams/parameters/x-visitor-type'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunAgentParam'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunAgentResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/agent-executor/v1/conversation_session/init:
    post:
      tags:
        - 对话Session
      summary: 初始化对话Session
      description: 初始化对话Session
      operationId: init_conversation_session
      parameters:
        - $ref: './schema/common_auth_header.yaml#/CommonAuthHeaderParams/parameters/x-user'
        - $ref: './schema/common_auth_header.yaml#/CommonAuthHeaderParams/parameters/x-visitor-type'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConversationSessionParam'
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversation_session_id:
                    type: string
                    title: conversation_session_id
                    description: 对话Session id
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    AgentConfig:
      allOf:
        - $ref: './schema/config_req.yaml#/config'
        - type: object
          properties:
            output_vars:
              items:
                type: string
              type: array
              description: 需要输出的变量
              title: Output Vars
            user_define:
              type: object
              description: 用户定义的变量,用于agent-app运行时记录用户运行信息
              title: User Define
            incremental_output:
              type: boolean
              title: Incremental Output
              description: 是否增量输出
              default: false
      type: object
      title: AgentConfig
      description: Agent配置
    AgentInput:
      properties:
        query:
          type: string
          title: Query
          description: 用户输入
        history:
          type: array
          items:
            type: object
            properties:
              role:
                type: string
                description: 角色
              content:
                type: string
                description: 内容
          title: History
          description: 历史记录
        tool:
          $ref: '#/components/schemas/ToolInterruptInfo'
          title: Tool
          description: 发生中断时，需要用户进行干预的工具信息
        header:
          type: object
          title: Header
          description: 请求头
        self_config:
          type: object
          title: Self Config
          description: 当前agent的配置信息
      additionalProperties: true
      type: object
      required:
      - query
      title: AgentInput
      description: Agent输入模型
    AgentOptions:
      properties:
        output_vars:
          items:
            type: string
          type: array
          description: 需要输出的变量
          title: Output Vars
        incremental_output:
          type: boolean
          title: Incremental Output
          description: 是否增量输出
          default: false
        data_source:
          $ref: './schema/retriever_data_source.yaml#/retriever_data_source'
          description: 数据源配置
          title: Data Source
        llm_config:
          $ref: './schema/llm_config.yaml#/llm_config'
          description: 默认使用的LLM配置
          title: Llm Config
        tmp_files:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                description: 文档ID
              type:
                type: string
                description: 类型(doc/wikidoc/faq)
              name:
                type: string
                description: 文档名称
          title: Tmp Files
          description: 临时文件列表
      type: object
      title: AgentOptions
      description: Agent运行选项, 此处如果有配置项，则覆盖config中的配置
    RunAgentParam:
      properties:
        id:
          type: string
          title: id
          description: agent id
          example: '1830930776523276288'
        config:
          allOf:
          - $ref: '#/components/schemas/AgentConfig'
          title: config
          description: agent配置
        input:
          allOf:
          - $ref: '#/components/schemas/AgentInput'
          title: input
          description: agent输入
          example:
            query: 你好
        _options:
          allOf:
          - $ref: '#/components/schemas/AgentOptions'
          title: options
          description: Agent运行选项
      type: object
      required:
        - input
      title: RunAgentParam
    RunAgentResponse:
      properties:
        answer:
          type: object
          title: answer
          description: agent最终输出，包含dolphin输出的全部内容
        status:
          type: string
          title: status
          description: '"True": 流式信息已结束; "False": 流式信息未结束，正在返回; "Error": 失败'
        ask:
          description: 需要用户进行干预的工具信息
          $ref: '#/components/schemas/ToolInterruptInfo'
        error:
          description: 错误信息
          $ref: '#/components/schemas/ErrorResponse'
        user_define:
          description: 用户定义的变量,用于agent-app运行时记录用户运行信息
          type: object
      type: object
      required:
      - answer
      - status
      title: RunAgentResponse
    ToolInterruptInfo:
      description: 工具中断信息
      type: object
      properties:
        session_id:
          type: string
          description: 会话id
        tool_name:
          type: string
          description: 工具名称
        tool_args:
          type: array
          description: 工具参数列表
          items:
            type: object
            properties:
              key:
                type: string
                description: 参数名称
              value:
                anyOf:
                  - type: string
                  - type: number
                  - type: boolean
                  - type: array
                  - type: object
                  - type: 'null'
                description: 参数值
              type:
                type: string
                description: 参数类型
    ErrorResponse:
      properties:
        description:
          description: 错误描述
          title: Description
          type: string
        error_code:
          description: 错误码
          title: Errorcode
          type: string
        error_details:
          description: 错误详情
          title: Errordetails
          type: string
        error_link:
          description: 错误链接
          title: Errorlink
          type: string
        solution:
          description: 解决方法
          title: Solution
          type: string
      required:
      - description
      - error_code
      - error_details
      - error_link
      - solution
      title: ErrorResponse
      type: object
    ConversationSessionParam:
      properties:
        conversation_id:
          type: string
          title: conversation_id
          description: 对话id
          example: 'xxx'
        agent_id:
          type: string
          title: agent_id
          description: agent id
          example: 'xxx'
        user_id:
          type: string
          title: user_id
          description: 用户id
          example: 'xxx'
        user_type:
          type: string
          title: user_type
          description: 用户类型
          example: 'xxx'
      type: object
      required:
        - conversation_id
        - agent_config
        - user_id
        - user_type
      title: ConversationSessionParam
